
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A minimal cloud aimed at small and edge deployments">
      
      
      
      
        <link rel="canonical" href="https://shakenfist.com/installation/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>Installation - Shaken Fist</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#installing-shaken-fist" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Shaken Fist" class="md-header__button md-logo" aria-label="Shaken Fist" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Shaken Fist
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Installation
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/shakenfist/shakenfist/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Shaken Fist" class="md-nav__button md-logo" aria-label="Shaken Fist" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Shaken Fist
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/shakenfist/shakenfist/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../manifesto/" class="md-nav__link">
        Manifesto
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../community/" class="md-nav__link">
        Community
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        User Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Installation
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#local-development" class="md-nav__link">
    Local development
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-installation" class="md-nav__link">
    Cluster installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#your-first-instance" class="md-nav__link">
    Your first instance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-cluster-deployments" class="md-nav__link">
    Real world cluster deployments
  </a>
  
    <nav class="md-nav" aria-label="Real world cluster deployments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-first-steps" class="md-nav__link">
    Common first steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#google-cloud-additional-first-steps" class="md-nav__link">
    Google Cloud additional first steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vmware-esxi-additional-first-steps" class="md-nav__link">
    VMWare ESXi additional first steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-caveats" class="md-nav__link">
    Other caveats
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-variables" class="md-nav__link">
    Deployment variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../development/state_machine/" class="md-nav__link">
        State machine
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        Usage
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Developer Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Developer Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Developer Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../development/ci_api_coverage/" class="md-nav__link">
        CI API coverage
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../development/ci_images/" class="md-nav__link">
        CI images
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../development/namespace_auth/" class="md-nav__link">
        Namespace Authentication
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../development/release_process/" class="md-nav__link">
        Releases
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../development/standards/" class="md-nav__link">
        Standards
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../development/state_machine/" class="md-nav__link">
        State machine
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../development/updating_docs/" class="md-nav__link">
        Website
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../development/git_usage/" class="md-nav__link">
        Workflow
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Operator Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Operator Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Operator Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" type="checkbox" id="__nav_6_1" >
      
      <label class="md-nav__link" for="__nav_6_1">
        Networking Explained
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Networking Explained" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Networking Explained
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../networking/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../networking/single_instance/" class="md-nav__link">
        Single Instance
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../power_states/" class="md-nav__link">
        Power States
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Change Log
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Change Log" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Change Log
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/changelog_v04/" class="md-nav__link">
        v0.4
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/changelog_v03/" class="md-nav__link">
        v0.3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/changelog_v02/" class="md-nav__link">
        v0.2
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#local-development" class="md-nav__link">
    Local development
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-installation" class="md-nav__link">
    Cluster installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#your-first-instance" class="md-nav__link">
    Your first instance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-cluster-deployments" class="md-nav__link">
    Real world cluster deployments
  </a>
  
    <nav class="md-nav" aria-label="Real world cluster deployments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-first-steps" class="md-nav__link">
    Common first steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#google-cloud-additional-first-steps" class="md-nav__link">
    Google Cloud additional first steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vmware-esxi-additional-first-steps" class="md-nav__link">
    VMWare ESXi additional first steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-caveats" class="md-nav__link">
    Other caveats
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-variables" class="md-nav__link">
    Deployment variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/shakenfist/shakenfist/edit/master/docs/installation.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="installing-shaken-fist">Installing Shaken Fist</h1>
<p>This guide will assume that you want to install Shaken Fist on a single local machine (that is, the one you're going to run ansible on). This is by no means the only installation option, but is the most simple to get people started.</p>
<p>Shaken Fist only supports Ubuntu 18.04 or later but we strongly recommend 20.04 or higher, so if you're running on localhost that implies that you must be running a recent Ubuntu on your development machine. Note as well that the deployer installs software and changes the configuration of your networking, so be careful when running it on machines you are fond of.</p>
<p>Note that we used to recommend deployers run the installer from git, but we've outgrown that approach. If you
see that mentioned in the documentation, you are likely reading outdated guides.</p>
<p>First install some dependancies:</p>
<pre><code class="language-bash">sudo apt-get update
sudo apt-get -y dist-upgrade
sudo apt-get -y install ansible tox pwgen build-essential python3-dev python3-wheel \
    python3-pip python3-venv curl ansible vim git pwgen
    python3-pip curl ansible vim git pwgen
ansible-galaxy install andrewrothstein.etcd-cluster andrewrothstein.terraform \
    andrewrothstein.go
</code></pre>
<p>And then manually upgrade pip:</p>
<pre><code>sudo pip3 install -U pip
sudo apt-get remove -y python3-pip
</code></pre>
<p>We require that Shaken Fist be installed into a venv at /srv/shakenfist/venv on each Shaken Fist machine. Create that now:</p>
<pre><code>sudo mkdir -p /srv/shakenfist/venv
sudo chown -R `whoami`.`whoami` /srv/shakenfist/venv
python3 -mvenv --system-site-packages /srv/shakenfist/venv
</code></pre>
<p>Next install your desired Shaken Fist pip package. The default should be the latest release.</p>
<pre><code>/srv/shakenfist/venv/bin/pip install -U shakenfist shakenfist_client
</code></pre>
<p>Because we're fancy, we should also create a symlink to the <code>sf-client</code> command so its easy to use without arguing with the virtual environment:</p>
<pre><code>sudo ln -s /srv/shakenfist/venv/bin/sf-client /usr/local/bin/sf-client
</code></pre>
<p>And then run the installer. We describe the correct invocation for a local development environment in the section below.</p>
<h2 id="local-development">Local development</h2>
<p>Shaken Fist uses ansible as its installer, with terraform to bring up cloud resources. Because we're going to install Shaken Fist on localhost, there isn't much terraform in this example. Installation is run by a simple wrapper called "install.sh".</p>
<p>We also make the assumption that developer laptops move around more than servers. In a traditional install we detect the primary NIC of the machine and then use that to build VXLAN meshes. For localhost single node deploys we instead create a bridge called "brsf" and then use that as our primary NIC. This means your machine can move around and have different routes to the internet over time, but it also means its fiddly to convert a localhost install into a real production cluster. Please only use localhost installs for development purposes.</p>
<pre><code>sudo CLOUD=localhost /usr/local/share/shakenfist/installer/install.sh
</code></pre>
<h2 id="cluster-installation">Cluster installation</h2>
<p>Installation is similar to that done on localhost, but there are some extra steps. First off, each machine in the cluster should match this description:</p>
<ul>
<li>Have virtualization extensions enabled in the BIOS.</li>
<li>Have jumbo frames enabled on the switch.</li>
<li>Have a cloudadmin account setup with passwordless sudo, and a ssh key in its authorized_keys file. This is an ansible requirement.</li>
</ul>
<p>Now create a file called sf-deploy.sh, which contains the details of your installation. For my home cluster, it looks like this:</p>
<pre><code>#!/bin/bash

export CLOUD=metal
export ADMIN_PASSWORD=...a...password...
export FLOATING_IP_BLOCK=&quot;192.168.10.0/24&quot;
export BOOTDELAY=0
export DEPLOY_NAME=&quot;bonkerslab&quot;
export METAL_SSH_USER=&quot;cloudadmin&quot;
export METAL_SSH_KEY_FILENAME=&quot;/root/.ssh/id_rsa&quot;

export KSM_ENABLED=1
export GLUSTER_ENABLED=1
export GLUSTER_REPLICAS=3

export METAL_IP_SF1=192.168.1.51
export METAL_IP_SF2=192.168.1.52
export METAL_IP_SF3=192.168.1.53
</code></pre>
<p>And then we can run the installer:</p>
<pre><code>sudo - bash
. sf-deploy.sh
/srv/shakenfist/venv/share/shakenfist/installer/install
</code></pre>
<h2 id="your-first-instance">Your first instance</h2>
<p>Before you can start your first instance you'll need to authenticate to Shaken Fist, and create a network. Shaken Fist's python api client (as used by the command line client) looks for authentication details in the following locations:</p>
<ul>
<li>Command line flags</li>
<li>Environment variables (prefixed with <strong>SHAKENFIST_</strong>)</li>
<li><strong>~/.shakenfist</strong>, a JSON formatted configuration file</li>
<li><strong>/etc/sf/shakenfist.json</strong>, the same file as above, but global</li>
</ul>
<p>By default the installer creates <strong>/etc/sf/sfrc</strong>, which sets the required environment variables to authenticate.<br />
It is customized per installation, setting the following variables:</p>
<ul>
<li><strong>SHAKENFIST_NAMESPACE</strong>, the namespace to create resources in</li>
<li><strong>SHAKENFIST_KEY</strong>, an authentication key for that namespace</li>
<li><strong>SHAKENFIST_API_URL</strong>, a URL to the Shaken Fist API server</li>
</ul>
<p>Before interacting with Shaken Fist, we need to source the rc file.  </p>
<pre><code class="language-bash">. /etc/sf/sfrc
</code></pre>
<p>Instances must be launched attached to a network.</p>
<p>Create your first network:</p>
<pre><code class="language-bash">sf-client network create mynet 192.168.42.0/24
</code></pre>
<p>You can get help for the command line client by running <code>`sf-client --help</code>. The above command creates a new network called "mynet", with the IP block 192.168.42.0/24. You will receive some descriptive output back:</p>
<pre><code class="language-bash">$ sf-client network create mynet 192.168.42.0/24
uuid            : 16baa325-5adf-473f-8e7a-75710a822d45
name            : mynet
vxlan id        : 2
netblock        : 192.168.42.0/24
provide dhcp    : True
provide nat     : True
floating gateway: None
namespace       : system
state           : initial

Metadata:
</code></pre>
<p>The UUID is important, as that is how we will refer to the network elsewhere. Let's now create a simple first instance (you'll need to change this to use your actual network UUID):</p>
<pre><code class="language-bash">$ sf-client instance create myvm 1 1024 -d 8@cirros -n 16baa325-5adf-473f-8e7a-75710a822d45
uuid        : c6c4ba94-ed34-497d-8964-c223489dee3e
name        : myvm
namespace   : system
cpus        : 1
memory      : 1024
disk spec   : type=disk   bus=None  size=8   base=cirros  
video       : model=cirrus  memory=16384  
node        : marvin
power state : on
state       : created
console port: 31839
vdi port    : 34442

ssh key     : None
user data   : None

Metadata:

Interfaces:

    uuid    : e56b3c7b-8056-4645-b5b5-1779721ff21d
    network : 16baa325-5adf-473f-8e7a-75710a822d45
    macaddr : ae:15:4d:9c:d8:c0
    order   : 0
    ipv4    : 192.168.42.76
    floating: None
    model   : virtio
</code></pre>
<p>Probably the easiest way to interact with this instance is to connect to its console port, which is the serial console of the instance over telnet. In the case above, that is available on port 31829 on localhost (my laptop is called marvin).</p>
<h2 id="real-world-cluster-deployments">Real world cluster deployments</h2>
<p>It is probably best to start with a localhost deployment first to become familiar with Shaken Fist. From that, you can build out your real world deployment. Deployments are based on Hashicorp terraform
configuration found in deploy/ansible/terraform/<cloud> where "cloud" is one of the following at the time of writing:</p>
<ul>
<li>aws: Amazon EC2 bare metal (3 node cluster)</li>
<li>aws-single-node: Amazon EC2 bare metal (1 node cluster), note that the CI tests will not pass on a single node cluster</li>
<li>gcp: Google cloud, using nested virtualization (see additional steps below). <strong>This deployment option is not for production use because of its lack of bare metal support and low MTUs affecting virtual network performance. We mainly use it for CI testing.</strong></li>
<li>metal: Baremetal provisioned outside of terraform</li>
<li>openstack: OpenStack, using nested virtualization</li>
<li>shakenfist: Shaken Fist can self host, this is useful for CI for example</li>
</ul>
<h3 id="common-first-steps">Common first steps</h3>
<pre><code class="language-bash">sudo apt-get install ansible tox pwgen build-essential python3-dev python3-wheel curl
git clone https://github.com/shakenfist/deploy
ansible-galaxy install andrewrothstein.etcd-cluster andrewrothstein.terraform andrewrothstein.go
</code></pre>
<h3 id="google-cloud-additional-first-steps">Google Cloud additional first steps</h3>
<p>On Google Cloud, you need to enable nested virt first:</p>
<pre><code class="language-bash"># Create an image with nested virt enabled (only once)
gcloud compute disks create sf-source-disk --image-project ubuntu-os-cloud \
    --image-family ubuntu-1804-lts --zone us-central1-b
gcloud compute images create sf-image \
  --source-disk sf-source-disk --source-disk-zone us-central1-b \
  --licenses &quot;https://compute.googleapis.com/compute/v1/projects/vm-options/global/licenses/enable-vmx&quot;
</code></pre>
<p>Please note that the gcp-xl cloud is a special definition used for larger scale CI testing. You're welcome to use it, but it does assume that the node performing the deployment is a Google cloud instance.</p>
<h3 id="vmware-esxi-additional-first-steps">VMWare ESXi additional first steps</h3>
<p>The "metal" installation option can be used to create a test cluster on VMWare ESXi hypervisors.</p>
<p>Virtual machines hosted under ESXi need two CPU options enabled.</p>
<pre><code>Hardware virtualization:
    Expose hardware assisted virtualization to the guest OS

Performance counters:
    Enable virtualized CPU performance counters
</code></pre>
<h3 id="other-caveats">Other caveats</h3>
<p>The installer will also enforce the following sanity checks:</p>
<ul>
<li>That KVM will operate on your machines. This is generally fine unless you're using virtual machines at which point nested virtualization needs to be enabled.</li>
<li>That your network interface MTU is greater than 2,000 bytes. This is required because the VXLAN mesh our virtual networks use add overhead to packets and a standard MTU of 1500 bytes for the physical network will result in packets being fragmented too frequently on the virtual networks. You can set a higher MTU if you desire, I generally select 9,000 bytes.</li>
</ul>
<h3 id="deployment">Deployment</h3>
<p>Each deployment takes slight different arguments. I tend to write a small shell script to wrap these up for
convenience. Here's an example for a baremetal deployment:</p>
<pre><code class="language-bash">$ cat ~/sf-deploys/cbr-remote.sh 
#!/bin/bash

export CLOUD=metal
export ADMIN_PASSWORD=&quot;p4ssw0rd&quot;
export FLOATING_IP_BLOCK=&quot;192.168.20.0/24&quot;
export BOOTDELAY=0

# Tests are not currently safe for clusters whose data you are fond of
export SKIP_SF_TESTS=1

./deployandtest.sh
</code></pre>
<p>I then execute that script from the deploy/ansible directory to do a deployment or upgrade. Note that running the
CI suite will destroy the contents of your cloud so be sure to use SKIP_SF_TESTS if you're upgrading a cluster
with real users.</p>
<h3 id="deployment-variables">Deployment variables</h3>
<table>
<thead>
<tr>
<th>Option</th>
<th>Terraform definition</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>CLOUD</td>
<td>All</td>
<td>The terraform definition to use</td>
</tr>
<tr>
<td>ADMIN_PASSWORD</td>
<td>All</td>
<td>The admin password for the cloud once installed</td>
</tr>
<tr>
<td>DNS_SERVER</td>
<td>All</td>
<td>The DNS server to configure instances with via DHCP. Defaults to 8.8.8.8</td>
</tr>
<tr>
<td>HTTP_PROXY</td>
<td>All</td>
<td>A URL for a HTTP proxy to use for image downloads. For example <a href="http://localhost:3128">http://localhost:3128</a></td>
</tr>
<tr>
<td>INCLUDE_TRACEBACKS</td>
<td>All</td>
<td>Whether to include tracebacks in server 500 errors. Never set this to true in production!</td>
</tr>
<tr>
<td>FLOATING_IP_BLOCK</td>
<td>All</td>
<td>The IP range to use for the floating network</td>
</tr>
<tr>
<td>BOOTDELAY</td>
<td>All</td>
<td>How long to wait for terraform deployed instances to boot before continuing with install, in minutes</td>
</tr>
<tr>
<td>SKIP_SF_TEST</td>
<td>All</td>
<td>Set to 1 to skip running destructive testing of the cloud</td>
</tr>
<tr>
<td>KSM_ENABLED</td>
<td>All</td>
<td>Set to 1 to enable KSM, 0 to disable</td>
</tr>
<tr>
<td>DEPLOY_NAME</td>
<td>All</td>
<td>The name of the deployment to use as an external label for prometheus</td>
</tr>
<tr>
<td>AWS_REGION</td>
<td>aws, aws-single-node</td>
<td>The AWS region to deploy in</td>
</tr>
<tr>
<td>AWS_AVAILABILITY_ZONE</td>
<td>aws, aws-single-node</td>
<td>The AWS availability zone to deploy in</td>
</tr>
<tr>
<td>AWS_VPC_ID</td>
<td>aws, aws-single-node</td>
<td>The AWS VPC to use</td>
</tr>
<tr>
<td>AWS_SSH_KEY_NAME</td>
<td>aws, aws-single-node</td>
<td>The name of an SSH key in the AWS region to use for ansible</td>
</tr>
<tr>
<td>GCP_PROJECT</td>
<td>gcp</td>
<td>The GCP project id to deploy in</td>
</tr>
<tr>
<td>GCP_SSH_KEY_FILENAME</td>
<td>gcp</td>
<td>The path to a ssh private key file to use for authentication. It is assumed that the public key is at <code>${GCP_SSH_KEY_FILENAME}.pub</code>. (optional, only required if not using gcloud).</td>
</tr>
<tr>
<td>GCP_SSH_USER</td>
<td>gcp</td>
<td>The username to add the GCP_SSH_KEY to. (optional, only used if GCPSSH_KEY_FILENAME is set).</td>
</tr>
<tr>
<td>NODE_IMAGE</td>
<td>gcp</td>
<td>The name of an image to use for the booted instances.</td>
</tr>
<tr>
<td>NODE_COUNT</td>
<td>gcp</td>
<td>The number of nodes to start.</td>
</tr>
<tr>
<td>OS_SSH_KEY_NAME</td>
<td>openstack</td>
<td>The name of a SSH key in the OpenStack cloud to use for ansible</td>
</tr>
<tr>
<td>OS_FLAVOR_NAME</td>
<td>openstack</td>
<td>The OpenStack flavor to use for instances</td>
</tr>
<tr>
<td>OS_EXTERNAL_NET_NAME</td>
<td>openstack</td>
<td>The UUID of an OpenStack network with internet access</td>
</tr>
<tr>
<td>METAL_IP_SF1</td>
<td>metal</td>
<td>The IP address of a baremetal machine</td>
</tr>
<tr>
<td>METAL_IP_SF2</td>
<td>metal</td>
<td>The IP address of a baremetal machine</td>
</tr>
<tr>
<td>METAL_IP_SF3</td>
<td>metal</td>
<td>The IP address of a baremetal machine</td>
</tr>
<tr>
<td>METAL_SSH_KEY_FILENAME</td>
<td>metal</td>
<td>The path to a ssh private key file to use for authentication. It is assumed that the public key is at <code>${METAL_SSH_KEY_FILENAME}.pub</code>.</td>
</tr>
<tr>
<td>METAL_SSH_USER</td>
<td>metal</td>
<td>The username to ssh as.</td>
</tr>
<tr>
<td>SHAKENFIST_KEY</td>
<td>shakenfist</td>
<td>The authentication key for a user on the shakenfist cluster to deploy in</td>
</tr>
<tr>
<td>SHAKENFIST_SSH_KEY</td>
<td>shakenfist</td>
<td>The <em>path</em> to a SSH key to use for ansible</td>
</tr>
</tbody>
</table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../community/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Community
            </div>
          </div>
        </a>
      
      
        <a href="../development/state_machine/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              State machine
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
    
  </body>
</html>