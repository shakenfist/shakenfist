
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A minimal cloud aimed at small and edge deployments">
      
      
      
        <link rel="canonical" href="https://shakenfist.com/developer_guide/api_reference/instances/">
      
      
        <link rel="prev" href="../blobs/">
      
      
        <link rel="next" href="../label/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.5">
    
    
      
        <title>Instances (/instances/) - Shaken Fist</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0e669242.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#instances-instances" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Shaken Fist" class="md-header__button md-logo" aria-label="Shaken Fist" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Shaken Fist
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Instances (/instances/)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/shakenfist/shakenfist" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Shaken Fist" class="md-nav__button md-logo" aria-label="Shaken Fist" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Shaken Fist
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/shakenfist/shakenfist" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../manifesto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manifesto
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Features
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../community/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Community
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/artifacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artifacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/affinity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Affinity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/consoles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Consoles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/objects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Object Metadata
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" checked>
        
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../admin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Admin (/admin/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../artifacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artifacts (/artifacts/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication (/auth/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../blob_checksums/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blob Checksums (/blob_checksums/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../blobs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blobs (/blobs/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Instances (/instances/)
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Instances (/instances/)
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fetching-information-about-an-instance" class="md-nav__link">
    Fetching information about an instance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instance-creation" class="md-nav__link">
    Instance creation
  </a>
  
    <nav class="md-nav" aria-label="Instance creation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diskspec" class="md-nav__link">
    diskspec
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networkspec" class="md-nav__link">
    networkspec
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#videospec" class="md-nav__link">
    videospec
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-instance-lifecycle-operations" class="md-nav__link">
    Other instance lifecycle operations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-instance-information" class="md-nav__link">
    Other instance information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#out-of-band-interactions-with-instances" class="md-nav__link">
    Out-of-band interactions with instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executing-commands-within-an-instance" class="md-nav__link">
    Executing commands within an instance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata" class="md-nav__link">
    Metadata
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../label/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Label (/label/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../networks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Networks (/networks/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../interfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Interfaces (/interfaces/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nodes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nodes (/nodes/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../upload/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upload (/upload/)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../ci_api_coverage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI API coverage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../release_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release process
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../state_machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State machine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../updating_docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating docs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Operator Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Operator Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../operator_guide/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../operator_guide/artifacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artifacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../operator_guide/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../operator_guide/locks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Locks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Networking
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Networking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../operator_guide/networking/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../operator_guide/networking/single_instance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Single Instance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../operator_guide/power_states/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power States
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../operator_guide/upgrades/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrades
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fetching-information-about-an-instance" class="md-nav__link">
    Fetching information about an instance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instance-creation" class="md-nav__link">
    Instance creation
  </a>
  
    <nav class="md-nav" aria-label="Instance creation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diskspec" class="md-nav__link">
    diskspec
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networkspec" class="md-nav__link">
    networkspec
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#videospec" class="md-nav__link">
    videospec
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-instance-lifecycle-operations" class="md-nav__link">
    Other instance lifecycle operations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-instance-information" class="md-nav__link">
    Other instance information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#out-of-band-interactions-with-instances" class="md-nav__link">
    Out-of-band interactions with instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executing-commands-within-an-instance" class="md-nav__link">
    Executing commands within an instance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata" class="md-nav__link">
    Metadata
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="instances-instances">Instances (/instances/)</h1>
<p>Instances sit at the core of Shaken Fist's functionality, and are the component
which ties most of the other concepts in the API together. Therefore, they are
also the most complicated part of Shaken Fist to explain. This description is
broken into basic functionality -- showing information about instances -- and then
moves onto more advanced topics like creation, deletion, and other lifecycle events.</p>
<details class="note" open="open">
<summary>Note</summary>
<p>For a detailed reference on the state machine for instances, see the
<a href="/developer_guide/state_machine/#instances">developer documentation on object states</a>.</p>
</details>
<h2 id="fetching-information-about-an-instance">Fetching information about an instance</h2>
<p>There are two main ways to fetch information about instances -- you can list all
instances visible to your authenticated namespace, or you can collect information
about a specific instance by providing its UUID or name.</p>
<details class="info" open="open">
<summary>Info</summary>
<p>Note that the amount of information visible in an instance response will change
over the lifecycle of the instance -- for example when you first request the
instance be created versus when the instance has had its disk specification
calculated.</p>
</details>
<details class="tip" open="open">
<summary>REST API calls</summary>
<ul>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/get_instances">GET /instances</a>: List all instances visible to your authenticated namespace.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/get_instances__instance_ref_">GET /instances/{instance_ref}</a>: Get information about a specific instance.</li>
</ul>
</details>
<details class="example">
<summary>Python API client: get all visible instances</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">instances</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instances</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div>
</details>
<details class="example">
<summary>Python API client: get information about a specific instance</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="s1">&#39;317e9b70-8e26-46af-a1c4-76931c0da5a9&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div>
</details>
<h2 id="instance-creation">Instance creation</h2>
<p>Instance creation is by far the most complicated call in Shaken Fist in terms
of the arguments that it takes. The code in the Python command line client is
helpful if you need a fully worked example of every possible permutation. The
OpenAPI documentation at <a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances">https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances</a>
provides comprehensive and up to date documentation on all the arguments to
the creation call.</p>
<p>The instance creation API call also takes three data structures: the <code>diskspec</code>;
the <code>networkspec</code>; and the <code>videospec</code>. These structures are not well documented
in the OpenAPI interface, so are documented here instead.</p>
<h3 id="diskspec">diskspec</h3>
<p>A <code>diskspec</code> consists of the following fields as a JSON dictionary:</p>
<ul>
<li>size (integer): the size of the disk in gigabytes.</li>
<li>base (string): the base image for the disk. This can be a variety of URL-like strings,
  as documented on <a href="/user_guide/artifacts/">the artifacts page in the user guide</a>.
  For a blank disk, omit this value.</li>
<li>bus (enum): the hardware bus the disk device should be attached to on the instance.
  In general you shouldn't care about this and can omit this value. However, in
  some cases, such as unmodified Microsoft Windows images it is required. The options
  available here are: sata; scsi; usb; virtio (the default); and nvme. While ide
  was previously supported, that support was removed in v0.7 due to extremely
  poor performance.</li>
<li>type (enum): the type of device. The default is "disk", but in some cases you might
  want "cdrom".</li>
</ul>
<p>A full example of a <code>diskspec</code> is therefore:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="s1">&#39;debian:11&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bus&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="kc">None</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="networkspec">networkspec</h3>
<p>Similarly, a <code>networkspec</code> consists of the following fields in a JSON dictionary:</p>
<ul>
<li>network_uuid (uuid): the UUID of the network the interface should exist on.</li>
<li>macaddress (string): the MAC address of the interface. Omit this value to be allocated
  a MAC address automatically.</li>
<li>address (string): the IPv4 address to assign to the interface. Omit this value to be
  allocated a random address.</li>
<li>model (enum): the model of the network interface card. In general you should not have
  to set this, although it can matter in some cases, such as unmodified Microsoft
  Windows images. The options include: i82551; i82557b; i82559er; ne2k_pci; pcnet;
  rtl8139; e1000; and virtio (the default).</li>
<li>float (boolean): whether to associate a floating IP with this interface to enable external
  accessibility to the instance. Note that you can float and unfloat an interface
  after instance creation if desired.</li>
</ul>
<h3 id="videospec">videospec</h3>
<p>A <code>videospec</code> differs from a <code>diskspec</code> and a <code>networkspec</code> in that it is not
passed as a list. You only have one <code>videospec</code> per instance. Once again, a
<code>videospec</code> is a JSON dictionary with the following fields:</p>
<ul>
<li>model (enum): the model of the video card to attach to the instance. Possible
  options include: vga; cirrus (the default); and qxl.</li>
<li>memory (integer): the amount of video RAM the video card should have, in
  kibibytes (blocks of 1024 bytes).</li>
<li>vdi (string): the VDI protocol to use. Options are "vnc", "spice" (the default), or
  "spiceconcurrent". spice and spiceconcurrent are the same except that spiceconcurrent
  allows limited multi-user sessions, with subsequent sessions not experiencing
  full VDI functionality.</li>
</ul>
<details class="tip" open="open">
<summary>REST API calls</summary>
<ul>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances">POST /instances/</a>: Create an instance.</li>
</ul>
</details>
<details class="example">
<summary>Python API client: create and then delete a simple instance</summary>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">create_instance</span><span class="p">(</span>
    <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">[{</span>
        <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="s1">&#39;debian:11&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bus&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;disk&#39;</span>
    <span class="p">}],</span>
    <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>
</code></pre></div>
</details>
<h2 id="other-instance-lifecycle-operations">Other instance lifecycle operations</h2>
<p>A variety of other lifecycle operations are available on instances, including
deletion, and power management.</p>
<p>The power management actions available are:</p>
<ul>
<li>soft reboot: gracefully request a reboot from the instance operating system
  via ACPI. This is not guaranteed to actually work, but if it does is much less
  likely to cause disk corruption on the instance.</li>
<li>hard reboot: the equivalent of holding the reset switch down on a physical machine
  until it reboots without operating system involvement.</li>
<li>power on: turn the instance on, as if the power switch was pressed.</li>
<li>power off: turn the instance immediately off, as if the power switch was held
  down on a physical machine.</li>
<li>pause: suspend execution of the instance, but leave it hot in RAM ready to
  restart.</li>
<li>unpause: unsuspend execution of the instance.</li>
</ul>
<details class="tip" open="open">
<summary>REST API calls</summary>
<ul>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/delete_instances__instance_ref_">DELETE /instances/{instance_ref}</a>: Delete an instance.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/delete_instances">DELETE /instances/</a>: Delete all instances in a namespace.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances__instance_ref__rebootsoft">POST ​/instances​/{instance_ref}​/rebootsoft</a>: Soft (ACPI) reboot the instance.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances__instance_ref__reboothard">POST ​/instances​/{instance_ref}​/reboothard</a>: Hard (reset switch) reboot the instance.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances__instance_ref__poweron">POST /instances/{instance_ref}/poweron</a>: Power the instance on.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances__instance_ref__poweroff">POST /instances/{instance_ref}/poweroff</a>: Power the instance off, as if holding the power switch down.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances__instance_ref__pause">POST /instances/{instance_ref}/pause</a>: Pause an instance.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances__instance_ref__unpause">POST /instances/{instance_ref}/unpause</a>: Unpause an instance.</li>
</ul>
</details>
<details class="example">
<summary>Python API client: create and then delete a simple instance</summary>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">create_instance</span><span class="p">(</span>
    <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">[{</span>
        <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="s1">&#39;debian:11&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bus&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;disk&#39;</span>
    <span class="p">}],</span>
    <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>
</code></pre></div>
</details>
<details class="example">
<summary>Python API client: attempt a soft reboot, and hard reboot if required</summary>
<p>Note that this example assumes the instance is running an image with the
Shaken Fist in guest agent installed.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">create_instance</span><span class="p">(</span>
    <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">[{</span>
        <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="s1">&#39;debian:11&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bus&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;disk&#39;</span>
    <span class="p">}],</span>
    <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">side_channels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sf-agent&#39;</span><span class="p">])</span>

<span class="c1"># Wait for the instance to be created, or error out. Use instance events to</span>
<span class="c1"># provide status updates during boot.</span>
<span class="k">while</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">]:</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance_events</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting for the instance to start: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">])</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

<span class="c1"># Check the instance is created correctly</span>
<span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;created&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance is not in a created state!&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance is created&#39;</span><span class="p">)</span>

<span class="c1"># Wait for the agent to report the reboot time</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;agent_system_boot_time&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting for agent to start: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;agent_state&#39;</span><span class="p">])</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

<span class="n">initial_boot</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;agent_system_boot_time&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance booted at </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">initial_boot</span><span class="p">)</span>

<span class="c1"># Now try to soft reboot the instance, wait up to 60 seconds for a reboot to</span>
<span class="c1"># be detected</span>
<span class="n">sf_client</span><span class="o">.</span><span class="n">reboot_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">],</span> <span class="n">hard</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Soft rebooting instance&#39;</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

<span class="c1"># Wait for the agent to report the reboot time again</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;agent_system_boot_time&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting for agent to start: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;agent_state&#39;</span><span class="p">])</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

<span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;agent_system_boot_time&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">initial_boot</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Boot time changed from </span><span class="si">%d</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="o">%</span> <span class="p">(</span><span class="n">initial_boot</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;agent_system_boot_time&#39;</span><span class="p">]))</span>

<span class="k">else</span><span class="p">:</span>
    <span class="c1"># We failed to soft reboot, let&#39;s hard reboot instead</span>
    <span class="n">sf_client</span><span class="o">.</span><span class="n">reboot_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">],</span> <span class="n">hard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance did not reboot, hard rebooting&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Sample output:</p>
<div class="highlight"><pre><span></span><code>$ python3 example.py
Waiting for the instance to start: schedule complete
Instance is created
Waiting for agent to start: not ready (no contact)
Waiting for agent to start: not ready (no contact)
Waiting for agent to start: not ready (no contact)
Instance booted at 1684404969
Soft rebooting instance
Boot time changed from 1684404969 to 1684405036.0
</code></pre></div>
</details>
<details class="example">
<summary>Python API client: power off and then on an instance</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">create_instance</span><span class="p">(</span>
        <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">[{</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="s1">&#39;debian:11&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bus&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;disk&#39;</span>
        <span class="p">}],</span>
        <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># Wait for the instance to be created, or error out. Use instance events to</span>
<span class="c1"># provide status updates during boot.</span>
<span class="k">while</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">]:</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance_events</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting for the instance to start: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">])</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

<span class="c1"># Check the instance is created correctly</span>
<span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;created&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance is not in a created state!&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance is created&#39;</span><span class="p">)</span>

<span class="c1"># Check the instance is created correctly</span>
<span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;power_state&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance is not in powered on state!&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Power the instance off</span>
<span class="n">sf_client</span><span class="o">.</span><span class="n">power_off_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>
<span class="k">while</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;power_state&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;off&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting for the instance to power off&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="c1"># Power the instance on</span>
<span class="n">sf_client</span><span class="o">.</span><span class="n">power_on_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>
<span class="k">while</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;power_state&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting for the instance to power on&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Waiting for the instance to start: set attribute
Instance is created
Waiting for the instance to power off
Waiting for the instance to power on
Done
</code></pre></div>
</details>
<details class="example">
<summary>Python API client: pause and unpause an instance</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">sf_client</span><span class="o">.</span><span class="n">pause_instance</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="n">sf_client</span><span class="o">.</span><span class="n">unpause_instance</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
</code></pre></div>
</details>
<h2 id="other-instance-information">Other instance information</h2>
<p>We can also request other information for an instance. For example, we can list the
instance's network interfaces, or the events for the instance. See the
<a href="/user_guide/events/">user guide</a> for a general introduction to the Shaken Fist
event system.</p>
<details class="tip" open="open">
<summary>REST API calls</summary>
<ul>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/get_instances__instance_ref__interfaces">GET /instances/{instance_ref}/interfaces</a>: Request information on the instance's network interfaces, if any.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/get_instances__instance_ref__events">GET /instances/{instance_ref}/events</a>: Fetch events for a specific instance.</li>
</ul>
</details>
<details class="example">
<summary>Python API client: list network interfaces for an instance</summary>
<p>Note that the interface details for an instance wont be populated until the
instance has started being created on the hypervisor node. Specifically, this
can be some time later if an image needs to be fetched from the Internet and
transcoded. Therefore in this example we wait for the instance to be created
before displaying interface details.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">create_instance</span><span class="p">(</span>
        <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">[{</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="s1">&#39;debian:11&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bus&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;disk&#39;</span>
        <span class="p">}],</span>
        <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># Wait for the instance to be created, or error out. Use instance events to</span>
<span class="c1"># provide status updates during boot.</span>
<span class="k">while</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">]:</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance_events</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting for the instance to start: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">])</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

<span class="c1"># Check the instance is created correctly</span>
<span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;created&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance is not in a created state!&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance is created&#39;</span><span class="p">)</span>

<span class="c1"># Fetch and display interface details</span>
<span class="n">ifaces</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance_interfaces</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ifaces</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>$ python3 example.py
Waiting for the instance to start: Fetching required blob ffdfce7f-728e-4b76-83c2-304e252f98b1, 30% complete
Instance is created
[
    {
        &quot;floating&quot;: null,
        &quot;instance_uuid&quot;: &quot;d512e9f5-98d6-4c36-8520-33b6fc6de15f&quot;,
        &quot;ipv4&quot;: &quot;10.0.0.6&quot;,
        &quot;macaddr&quot;: &quot;02:00:00:73:18:66&quot;,
        &quot;metadata&quot;: {},
        &quot;model&quot;: &quot;virtio&quot;,
        &quot;network_uuid&quot;: &quot;6aaaf243-0406-41a1-aa13-5d79a0b8672d&quot;,
        &quot;order&quot;: 0,
        &quot;state&quot;: &quot;created&quot;,
        &quot;uuid&quot;: &quot;b1981e81-b37a-4176-ba37-b61bc7208012&quot;,
        &quot;version&quot;: 3
    }
]
</code></pre></div>
</details>
<details class="example">
<summary>Python API client: list events for an instance</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">interfaces</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance_events</span><span class="p">(</span><span class="s1">&#39;c0d52a77-0f8a-4f19-bec7-0c05efb03cb4&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">interfaces</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div>
<p>Note that events are returned in reverse chronological order and are limited
to the 100 most recent events.</p>
<div class="highlight"><pre><span></span><code>$python3 example.py
[
    ...
    {
        &quot;duration&quot;: null,
        &quot;extra&quot;: {
            &quot;cpu usage&quot;: {
                &quot;cpu time ns&quot;: 357485828000,
                &quot;system time ns&quot;: 66297716000,
                &quot;user time ns&quot;: 291188112000
            },
            &quot;disk usage&quot;: {
                &quot;vda&quot;: {
                    &quot;actual bytes on disk&quot;: 956301312,
                    &quot;errors&quot;: -1,
                    &quot;read bytes&quot;: 406776320,
                    &quot;read requests&quot;: 12225,
                    &quot;write bytes&quot;: 2105954304,
                    &quot;write requests&quot;: 3657
                },
                &quot;vdb&quot;: {
                    &quot;actual bytes on disk&quot;: 102400,
                    &quot;errors&quot;: -1,
                    &quot;read bytes&quot;: 279552,
                    &quot;read requests&quot;: 74,
                    &quot;write bytes&quot;: 0,
                    &quot;write requests&quot;: 0
                }
            },
            &quot;network usage&quot;: {
                &quot;02:00:00:1d:24:ae&quot;: {
                    &quot;read bytes&quot;: 147084732,
                    &quot;read drops&quot;: 0,
                    &quot;read errors&quot;: 0,
                    &quot;read packets&quot;: 16484,
                    &quot;write bytes&quot;: 2166754,
                    &quot;write drops&quot;: 0,
                    &quot;write errors&quot;: 0,
                    &quot;write packets&quot;: 13144
                }
            }
        },
        &quot;fqdn&quot;: &quot;sf-2&quot;,
        &quot;message&quot;: &quot;usage&quot;,
        &quot;timestamp&quot;: 1685229509.9592097,
        &quot;type&quot;: &quot;usage&quot;
    },
    ...
]
</code></pre></div>
</details>
<h2 id="out-of-band-interactions-with-instances">Out-of-band interactions with instances</h2>
<p>Shaken Fist supports three types of instance consoles, which provide out-of-band
management of instances -- that is, the instance does not need to have functioning
networking for these consoles to work. You can read a general introduction of
Shaken Fist's console functionality in <a href="/user_guide/consoles/">the user guide</a>.
This page focuses on the API calls which are used to implement the console
functionality in the Shaken Fist client.</p>
<ul>
<li>Read only console: to download the most recent portion of the read only text
  serial console, or clear the console, use the
  <code>/instances/{instance_ref}/consoledata</code> API calls below.</li>
<li>Interactive serial console: lookup the console port from the instance details
  fetch (as described above), and then connect to that port on the hypervisor
  node with a TCP client such as telnet.</li>
<li>Interactive VDI console: lookup the VDI console port from the instance details
  fetch (as described above), and then connect to that port on the hypervisor
  with the correct client (currently one of VNC or SPICE). Alternatively, use
  the <code>/instances/{instance_ref}/vdiconsolehelper</code> API call described below to
  download a <code>virt-viewer</code> configuration file and then connect with <code>virt-viewer</code>.
  See the example below for more details.</li>
</ul>
<details class="tip" open="open">
<summary>REST API calls</summary>
<ul>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/get_instances__instance_ref__consoledata">GET /instances/{instance_ref}/consoledata</a>: Fetch read only serial console data for an instance</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/delete_instances__instance_ref__consoledata">DELETE /instances/{instance_ref}/consoledata</a>: Clear the read only serial console for an instance.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/get_instances__instance_ref__vdiconsolehelper">GET /instances/{instance_ref}/vdiconsolehelper</a>: Generate and return a <code>virt-viewer</code> configuration file for connecting to the interactive VDI console for the instance (if configured).</li>
</ul>
</details>
<details class="example">
<summary>Python API client: connect seamlessly to a VDI console using virt-viewer</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">create_instance</span><span class="p">(</span>
        <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">[{</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="s1">&#39;debian:11&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bus&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;disk&#39;</span>
        <span class="p">}],</span>
        <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># Wait for the instance to be created, or error out. Use instance events to</span>
<span class="c1"># provide status updates during boot.</span>
<span class="k">while</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">]:</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance_events</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting for the instance to start: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">])</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

<span class="c1"># Check the instance is created correctly</span>
<span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;created&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance is not in a created state!&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance is created&#39;</span><span class="p">)</span>

<span class="c1"># We don&#39;t use NamedTemporaryFile as a context manager as the .vv file</span>
<span class="c1"># will also attempt to clean up the file.</span>
<span class="p">(</span><span class="n">temp_handle</span><span class="p">,</span> <span class="n">temp_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
<span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">temp_handle</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sf_client</span><span class="o">.</span><span class="n">get_vdi_console_helper</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">]))</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;remote-viewer </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">temp_name</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Remote viewer process exited with </span><span class="si">%d</span><span class="s1"> return code&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">temp_name</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_name</span><span class="p">)</span>
</code></pre></div>
</details>
<h2 id="executing-commands-within-an-instance">Executing commands within an instance</h2>
<p>Assuming a given instance has the Shaken Fist agent installed and running, and
was created with a <code>sf-agent</code> side channel, you can use the Shaken Fist agent to
move data into and out of the instance and execute commands without the instance
needing to have working networking configured. You can read more about the exact
requirements for agent connectivity in the  <a href="/developer_guide/api_reference/agentoperations/">API reference guide for agent operations</a>.</p>
<p>Agent Operations are not created directly -- they are a side effect of a call to
one of the API methods below, which create an Agent Operation so the caller can
track the state of their request. At the time of writing, you can perform the
following operations via the agent:</p>
<ul>
<li>copy the contents of a blob into an instance and change its file permissions.
  The python API client has a helper to upload the file into a blob before copying
  to the instance.</li>
<li>execute a command and return its results (exit code, stdout, stderr).</li>
</ul>
<details class="tip" open="open">
<summary>REST API calls</summary>
<ul>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances__instance_ref__agent_execute">POST ​/instances​/{instance_ref}​/agent​/execute</a>: execute a command within an instance and return results.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances__instance_ref__agent_put">POST /instances/{instance_ref}/agent/put</a>: copy a blob into an instance at the specified location with the specified permissions.</li>
</ul>
</details>
<p>...</p>
<h2 id="metadata">Metadata</h2>
<p>All objects exposed by the REST API may have metadata associated with them. This
metadata is for storing values that are of interest to the owner of the resources,
not Shaken Fist. Shaken Fist does not attempt to interpret these values at all,
with the exception of the <a href="/user_guide/affinity/">instance affinity metadata values</a>.
The metadata store is in the form of a key value store, and a general introduction
is available <a href="/user_guide/metadata/">in the user guide</a>.</p>
<details class="info" open="open">
<summary>Info</summary>
<p>Note that for affinity metadata to be processed by the scheduler, it must be
present in the instance create API call, which is why that call takes a
metadata argument. Adding affinity metadata after instance creation will not
affect the placement of that instance, but would affect the placement of
future instances.</p>
</details>
<details class="tip" open="open">
<summary>REST API calls</summary>
<ul>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/get_instances__instance_ref__metadata">GET ​/instances​/{instance_ref}​/metadata</a>: Get metadata for an instance.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/post_instances__instance_ref__metadata">POST /instances/{instance_ref}/metadata</a>: Create a new metadata key for an instance.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/delete_instances__instance_ref__metadata__key_">DELETE /instances/{instance_ref}/metadata/{key}</a>: Delete a specific metadata key for an instance.</li>
<li><a href="https://sfcbr.shakenfist.com/api/apidocs/#/instances/put_instances__instance_ref__metadata__key_">PUT /instances/{instance_ref}/metadata/{key}</a>: Update an existing metadata key for an instance.</li>
</ul>
</details>
<details class="example">
<summary>Python API client: set metadata on an instance</summary>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">sf_client</span><span class="o">.</span><span class="n">set_instance_metadata_item</span><span class="p">(</span><span class="n">instance_uuid</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="example">
<summary>Python API client: get metadata for an instance</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">md</span> <span class="o">=</span> <span class="n">sf_client</span><span class="o">.</span><span class="n">get_instance_metadata</span><span class="p">(</span><span class="n">instance_uuid</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">md</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div>
</details>
<details class="example">
<summary>Python API client: delete metadata for an instance</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">shakenfist_client</span> <span class="kn">import</span> <span class="n">apiclient</span>

<span class="n">sf_client</span> <span class="o">=</span> <span class="n">apiclient</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">sf_client</span><span class="o">.</span><span class="n">delete_instance_metadata_item</span><span class="p">(</span><span class="n">instance_uuid</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span>
</code></pre></div>
</details>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.78eede0e.min.js"></script>
      
    
  </body>
</html>