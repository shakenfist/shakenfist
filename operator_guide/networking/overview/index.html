
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A minimal cloud aimed at small and edge deployments">
      
      
      
        <link rel="canonical" href="https://shakenfist.com/operator_guide/networking/overview/">
      
      
        <link rel="prev" href="../../locks/">
      
      
        <link rel="next" href="../../power_states/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.2.7">
    
    
      
        <title>Networking - Shaken Fist</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.046329b4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#explaining-shaken-fist-networking" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Shaken Fist" class="md-header__button md-logo" aria-label="Shaken Fist" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Shaken Fist
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Networking
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/shakenfist/shakenfist" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Shaken Fist" class="md-nav__button md-logo" aria-label="Shaken Fist" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Shaken Fist
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/shakenfist/shakenfist" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../manifesto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manifesto
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Features
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Release notes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Release notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../release_notes/v07-v08/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v0.7 to v0.8 (unreleased)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../community/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Community
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/artifacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artifacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/affinity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Affinity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/consoles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Consoles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/objects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Object Metadata
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
        
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/admin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Admin (/admin/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/agentoperations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agent Operations (/agentoperations/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/artifacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artifacts (/artifacts/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication (/auth/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/blob_checksums/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blob Checksums (/blob_checksums/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/blobs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blobs (/blobs/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/instances/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instances (/instances/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/label/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Label (/label/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/networks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Networks (/networks/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/interfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Interfaces (/interfaces/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/nodes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nodes (/nodes/)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/api_reference/upload/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upload (/upload/)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/ci_api_coverage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI API coverage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/release_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release process
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/standards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/state_machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State machine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/updating_docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating docs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer_guide/workflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Operator Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Operator Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../artifacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artifacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../locks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Locks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Networking
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Networking
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#single-node-install-no-networks-or-instances" class="md-nav__link">
    Single node install, no networks or instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-node-install-one-network-and-no-instances" class="md-nav__link">
    Single node install, one network and no instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-node-install-one-network-and-one-instance-with-no-floating-ip" class="md-nav__link">
    Single node install, one network and one instance with no floating IP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-node-install-one-network-and-one-instance-with-no-floating-ip_1" class="md-nav__link">
    Single node install, one network and one instance with no floating IP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-nodes" class="md-nav__link">
    Multiple nodes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#routed-ips" class="md-nav__link">
    Routed IPs
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../power_states/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power States
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrades/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrades
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#single-node-install-no-networks-or-instances" class="md-nav__link">
    Single node install, no networks or instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-node-install-one-network-and-no-instances" class="md-nav__link">
    Single node install, one network and no instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-node-install-one-network-and-one-instance-with-no-floating-ip" class="md-nav__link">
    Single node install, one network and one instance with no floating IP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-node-install-one-network-and-one-instance-with-no-floating-ip_1" class="md-nav__link">
    Single node install, one network and one instance with no floating IP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-nodes" class="md-nav__link">
    Multiple nodes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#routed-ips" class="md-nav__link">
    Routed IPs
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="explaining-shaken-fist-networking">Explaining Shaken Fist networking</h1>
<p>Shaken Fist networking is complicated, but not as complicated as OpenStack
Neutron -- its more like the old OpenStack Compute nova-network implementation
if you're looking for a mental model. Let's work through some examples to explain
what it is doing.</p>
<h2 id="single-node-install-no-networks-or-instances">Single node install, no networks or instances</h2>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>ip<span class="w"> </span>a
<span class="m">1</span>:<span class="w"> </span>lo:<span class="w"> </span>&lt;LOOPBACK,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">65536</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>state<span class="w"> </span>UNKNOWN<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/loopback<span class="w"> </span><span class="m">00</span>:00:00:00:00:00<span class="w"> </span>brd<span class="w"> </span><span class="m">00</span>:00:00:00:00:00
<span class="w">    </span>inet<span class="w"> </span><span class="m">127</span>.0.0.1/8<span class="w"> </span>scope<span class="w"> </span>host<span class="w"> </span>lo
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="m">2</span>:<span class="w"> </span>eth0:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">8950</span><span class="w"> </span>qdisc<span class="w"> </span>pfifo_fast<span class="w"> </span>state<span class="w"> </span>UP<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span><span class="m">02</span>:00:00:00:0e:a3<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff
<span class="w">    </span>altname<span class="w"> </span>enp0s11
<span class="w">    </span>altname<span class="w"> </span>ens11
<span class="w">    </span>inet<span class="w"> </span><span class="m">10</span>.0.0.74/24<span class="w"> </span>brd<span class="w"> </span><span class="m">10</span>.0.0.255<span class="w"> </span>scope<span class="w"> </span>global<span class="w"> </span>eth0
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="m">3</span>:<span class="w"> </span>egr-br-eth0:<span class="w"> </span>&lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">1500</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>state<span class="w"> </span>DOWN<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span>f6:d1:c6:05:15:fd<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff
<span class="w">    </span>inet<span class="w"> </span><span class="m">192</span>.168.15.1/24<span class="w"> </span>scope<span class="w"> </span>global<span class="w"> </span>egr-br-eth0
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
</code></pre></div>
<p>Explaining this:</p>
<ul>
<li><code>lo</code> is the loopback interface, and not relevant here.</li>
<li><code>eth0</code> is the primary interface for the machine, and <code>10.0.0.74</code> is the IP
  address of the machine.</li>
<li><code>egr-br-eth0</code> is a linux bridge that is currently empty and has the IP
  <code>192.168.15.1</code>, which is the first IP on this cluster's floating network.
  Networks will get attached</li>
</ul>
<h2 id="single-node-install-one-network-and-no-instances">Single node install, one network and no instances</h2>
<p>Let's make a network, but not put any instances on it yet:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>sf-client<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>demo<span class="w"> </span><span class="m">172</span>.16.0.0/24
uuid<span class="w">            </span>:<span class="w"> </span>17be6538-8f96-4ccb-b71e-a7e3022fead3
name<span class="w">            </span>:<span class="w"> </span>demo
vxlan<span class="w"> </span>id<span class="w">        </span>:<span class="w"> </span><span class="m">14823439</span>
netblock<span class="w">        </span>:<span class="w"> </span><span class="m">172</span>.16.0.0/24
provide<span class="w"> </span>dhcp<span class="w">    </span>:<span class="w"> </span>True
provide<span class="w"> </span>nat<span class="w">     </span>:<span class="w"> </span>True
floating<span class="w"> </span>gateway:<span class="w"> </span><span class="m">192</span>.168.15.194
namespace<span class="w">       </span>:<span class="w"> </span>system
state<span class="w">           </span>:<span class="w"> </span>created

Metadata:

debian@test:~$<span class="w"> </span>ip<span class="w"> </span>a
<span class="m">1</span>:<span class="w"> </span>lo:<span class="w"> </span>&lt;LOOPBACK,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">65536</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>state<span class="w"> </span>UNKNOWN<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/loopback<span class="w"> </span><span class="m">00</span>:00:00:00:00:00<span class="w"> </span>brd<span class="w"> </span><span class="m">00</span>:00:00:00:00:00
<span class="w">    </span>inet<span class="w"> </span><span class="m">127</span>.0.0.1/8<span class="w"> </span>scope<span class="w"> </span>host<span class="w"> </span>lo
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="m">2</span>:<span class="w"> </span>eth0:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">8950</span><span class="w"> </span>qdisc<span class="w"> </span>pfifo_fast<span class="w"> </span>state<span class="w"> </span>UP<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span><span class="m">02</span>:00:00:00:0e:a3<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff
<span class="w">    </span>altname<span class="w"> </span>enp0s11
<span class="w">    </span>altname<span class="w"> </span>ens11
<span class="w">    </span>inet<span class="w"> </span><span class="m">10</span>.0.0.74/24<span class="w"> </span>brd<span class="w"> </span><span class="m">10</span>.0.0.255<span class="w"> </span>scope<span class="w"> </span>global<span class="w"> </span>eth0
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="m">3</span>:<span class="w"> </span>egr-br-eth0:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">1500</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>state<span class="w"> </span>UP<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span>f6:d1:c6:05:15:fd<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff
<span class="w">    </span>inet<span class="w"> </span><span class="m">192</span>.168.15.1/24<span class="w"> </span>scope<span class="w"> </span>global<span class="w"> </span>egr-br-eth0
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="m">10</span>:<span class="w"> </span>vxlan-e2300f:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">8900</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>master<span class="w"> </span>br-vxlan-e2300f<span class="w"> </span>state<span class="w"> </span>UNKNOWN<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span>6a:c0:ee:6f:83:6f<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff
<span class="m">11</span>:<span class="w"> </span>br-vxlan-e2300f:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">8900</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>state<span class="w"> </span>UP<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span>8a:a6:8d:31:c9:09<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff
<span class="m">13</span>:<span class="w"> </span>veth-e2300f-o@if12:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">8900</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>master<span class="w"> </span>br-vxlan-e2300f<span class="w"> </span>state<span class="w"> </span>UP<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span>6e:34:bc:25:68:c2<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff<span class="w"> </span>link-netns<span class="w"> </span>17be6538-8f96-4ccb-b71e-a7e3022fead3
<span class="m">15</span>:<span class="w"> </span>egr-e2300f-o@if14:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">1500</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>master<span class="w"> </span>egr-br-eth0<span class="w"> </span>state<span class="w"> </span>UP<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span>5a:9c:f3:eb:2f:bc<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff<span class="w"> </span>link-netns<span class="w"> </span>17be6538-8f96-4ccb-b71e-a7e3022fead3
</code></pre></div>
<p>Here, we allocated a network, which was assigned VXLAN id 14823439 (<code>e2300f</code> in
hexadecimal). That created a VXLAN interface named <code>vxlan-e2300f</code> on the machine,
which is where other machines in a multinode cluster would attach for the VXLAN
mesh which forms our virtual network. <code>br-vxlan-e2300f</code> is a linux bridge used to
attach the local network namespace for this network to the VXLAN interface. That
is, the members of the bridge look like this:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>sudo<span class="w"> </span>brctl<span class="w"> </span>show<span class="w"> </span>br-vxlan-e2300f
bridge<span class="w"> </span>name<span class="w">         </span>bridge<span class="w"> </span>id<span class="w">           </span>STP<span class="w"> </span>enabled<span class="w">     </span>interfaces
br-vxlan-e2300f<span class="w">     </span><span class="m">8000</span>.8aa68d31c909<span class="w">   </span>no<span class="w">              </span>veth-e2300f-o
<span class="w">                                                        </span>vxlan-e2300f
</code></pre></div>
<p>Similarly, the egress bridge <code>egr-br-eth0</code> now contains a veth as well:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>sudo<span class="w"> </span>brctl<span class="w"> </span>show<span class="w"> </span>egr-br-eth0
bridge<span class="w"> </span>name<span class="w">         </span>bridge<span class="w"> </span>id<span class="w">           </span>STP<span class="w"> </span>enabled<span class="w">     </span>interfaces
egr-br-eth0<span class="w">         </span><span class="m">8000</span>.f6d1c60515fd<span class="w">   </span>no<span class="w">              </span>egr-e2300f-o
</code></pre></div>
<p>And there is a linux network namespace named with the UUID of the network:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>ls<span class="w"> </span>/var/run/netns/
17be6538-8f96-4ccb-b71e-a7e3022fead3
</code></pre></div>
<p>That linux network namespace contains the other ends of the veths:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>17be6538-8f96-4ccb-b71e-a7e3022fead3<span class="w"> </span>ip<span class="w"> </span>a
<span class="m">1</span>:<span class="w"> </span>lo:<span class="w"> </span>&lt;LOOPBACK&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">65536</span><span class="w"> </span>qdisc<span class="w"> </span>noop<span class="w"> </span>state<span class="w"> </span>DOWN<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/loopback<span class="w"> </span><span class="m">00</span>:00:00:00:00:00<span class="w"> </span>brd<span class="w"> </span><span class="m">00</span>:00:00:00:00:00
<span class="m">12</span>:<span class="w"> </span>veth-e2300f-i@if13:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">1500</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>state<span class="w"> </span>UP<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span><span class="m">36</span>:da:87:ea:ce:16<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff<span class="w"> </span>link-netnsid<span class="w"> </span><span class="m">0</span>
<span class="w">    </span>inet<span class="w"> </span><span class="m">172</span>.16.0.1/24<span class="w"> </span>scope<span class="w"> </span>global<span class="w"> </span>veth-e2300f-i
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="w">    </span>inet6<span class="w"> </span>fe80::34da:87ff:feea:ce16/64<span class="w"> </span>scope<span class="w"> </span>link
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="m">14</span>:<span class="w"> </span>egr-e2300f-i@if15:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">1500</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>state<span class="w"> </span>UP<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span>d2:b0:c8:31:f4:83<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff<span class="w"> </span>link-netnsid<span class="w"> </span><span class="m">0</span>
<span class="w">    </span>inet<span class="w"> </span><span class="m">192</span>.168.15.194/24<span class="w"> </span>scope<span class="w"> </span>global<span class="w"> </span>egr-e2300f-i
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="w">    </span>inet6<span class="w"> </span>fe80::d0b0:c8ff:fe31:f483/64<span class="w"> </span>scope<span class="w"> </span>link
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
</code></pre></div>
<p>This network namespace exists to contain a <code>dnsmasq</code> process providing DHCP to
the virtual network, as well as to contain routing and iptables rules for mangling
traffic into and out of the virtual network.</p>
<p>Specifically, NAT for traffic from the virtual network to the outside world is
implemented with routing and iptables like this:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>17be6538-8f96-4ccb-b71e-a7e3022fead3<span class="w"> </span>ip<span class="w"> </span>route
default<span class="w"> </span>via<span class="w"> </span><span class="m">192</span>.168.15.1<span class="w"> </span>dev<span class="w"> </span>egr-e2300f-i
<span class="m">172</span>.16.0.0/24<span class="w"> </span>dev<span class="w"> </span>veth-e2300f-i<span class="w"> </span>proto<span class="w"> </span>kernel<span class="w"> </span>scope<span class="w"> </span>link<span class="w"> </span>src<span class="w"> </span><span class="m">172</span>.16.0.1
<span class="m">192</span>.168.15.0/24<span class="w"> </span>dev<span class="w"> </span>egr-e2300f-i<span class="w"> </span>proto<span class="w"> </span>kernel<span class="w"> </span>scope<span class="w"> </span>link<span class="w"> </span>src<span class="w"> </span><span class="m">192</span>.168.15.194

debian@test:~$<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>17be6538-8f96-4ccb-b71e-a7e3022fead3<span class="w"> </span>iptables<span class="w"> </span>-L<span class="w"> </span>-t<span class="w"> </span>nat
Chain<span class="w"> </span>PREROUTING<span class="w"> </span><span class="o">(</span>policy<span class="w"> </span>ACCEPT<span class="o">)</span>
target<span class="w">     </span>prot<span class="w"> </span>opt<span class="w"> </span><span class="nb">source</span><span class="w">               </span>destination

Chain<span class="w"> </span>INPUT<span class="w"> </span><span class="o">(</span>policy<span class="w"> </span>ACCEPT<span class="o">)</span>
target<span class="w">     </span>prot<span class="w"> </span>opt<span class="w"> </span><span class="nb">source</span><span class="w">               </span>destination

Chain<span class="w"> </span>OUTPUT<span class="w"> </span><span class="o">(</span>policy<span class="w"> </span>ACCEPT<span class="o">)</span>
target<span class="w">     </span>prot<span class="w"> </span>opt<span class="w"> </span><span class="nb">source</span><span class="w">               </span>destination

Chain<span class="w"> </span>POSTROUTING<span class="w"> </span><span class="o">(</span>policy<span class="w"> </span>ACCEPT<span class="o">)</span>
target<span class="w">     </span>prot<span class="w"> </span>opt<span class="w"> </span><span class="nb">source</span><span class="w">               </span>destination
MASQUERADE<span class="w">  </span>all<span class="w">  </span>--<span class="w">  </span><span class="m">172</span>.16.0.0/24<span class="w">        </span>anywhere
</code></pre></div>
<p>So, the default route is via the egress veth at <code>egr-e2300f-i</code> (inside the
namespace), which comes out on <code>egr-br-eth0</code> (outside the namespace) to be routed
as normal. Traffic to other machines participating in this virtual network (that
is, with the same VXLAN id configured), is routed to <code>veth-e2300f-i</code> (inside the
namespace) which comes out on the <code>br-vxlan-e2300f</code> (outside the namespace) bridge
which is wired to the linux kernel VXLAN interface at <code>vxlan-e2300f</code>. Finally,
traffic to other floating IPs on <code>192.168.15.0/24</code> is routed to the egress
bridge as well.</p>
<p>The iptables <code>MASQUERADE</code> entry is there to convert internal addresses to the
external <code>192.168.15.194</code> "floating gateway" address so instances can talk outside
their virtual network.</p>
<p>Perhaps a diagram would help!</p>
<p><img alt="SF single node networking with no instances" src="../sf-single-node-networking-no-instances.png" /></p>
<h2 id="single-node-install-one-network-and-one-instance-with-no-floating-ip">Single node install, one network and one instance with no floating IP</h2>
<p>Now let's create a single instance on that network, with the instance specifically
not having a floating IP:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>sf-client<span class="w"> </span>instance<span class="w"> </span>create<span class="w"> </span>demo<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span>-d<span class="w"> </span><span class="m">10</span>@debian:11<span class="w"> </span>-n<span class="w"> </span>demo
uuid<span class="w">          </span>:<span class="w"> </span>3b9c13ee-405f-4195-b904-cffb34e022d3
...

Interfaces:

<span class="w">    </span>uuid<span class="w">    </span>:<span class="w"> </span>afc470fb-8348-4711-8c16-be4c4662d705
<span class="w">    </span>network<span class="w"> </span>:<span class="w"> </span>17be6538-8f96-4ccb-b71e-a7e3022fead3
<span class="w">    </span>macaddr<span class="w"> </span>:<span class="w"> </span><span class="m">02</span>:00:00:bd:cd:9b
<span class="w">    </span>order<span class="w">   </span>:<span class="w"> </span><span class="m">0</span>
<span class="w">    </span>ipv4<span class="w">    </span>:<span class="w"> </span><span class="m">172</span>.16.0.232
<span class="w">    </span>floating:<span class="w"> </span>None
<span class="w">    </span>model<span class="w">   </span>:<span class="w"> </span>virtio
...
</code></pre></div>
<p>There is only one new outer network interface created by adding the instance:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>ip<span class="w"> </span>a
...
<span class="m">16</span>:<span class="w"> </span>vnet0:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">8900</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>master<span class="w"> </span>br-vxlan-e2300f<span class="w"> </span>state<span class="w"> </span>UNKNOWN<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span>fe:00:00:bd:cd:9b<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff
</code></pre></div>
<p><code>vnet0</code> is a libvirt construct to attach the virtual machine's network interface
to the host OS. We attach that interface to the bridge that is the virtual network
for this machine, in this case <code>br-vxlan-e2300f</code>:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>sudo<span class="w"> </span>brctl<span class="w"> </span>show<span class="w"> </span>br-vxlan-e2300f
bridge<span class="w"> </span>name<span class="w">         </span>bridge<span class="w"> </span>id<span class="w">           </span>STP<span class="w"> </span>enabled<span class="w">     </span>interfaces
br-vxlan-e2300f<span class="w">     </span><span class="m">8000</span>.8aa68d31c909<span class="w">   </span>no<span class="w">              </span>veth-e2300f-o
<span class="w">                                                        </span>vnet0
<span class="w">                                                        </span>vxlan-e2300f
</code></pre></div>
<p>There are no changes to the inside of the network namespace for this VM -- the
<code>dnsmasq</code> process for example is already connected to the virtual network by
virtue of the <code>veth-e2300f</code> pair and can therefore provide DHCP to the instance.</p>
<p>Again perhaps a diagram will help:</p>
<p><img alt="SF single node networking, one instance with no floating interfaces" src="../sf-single-node-networking-unfloat-instance.png" /></p>
<p>This instance is not accessible from outside our virtual network as it does not
have a floating IP. It can however talk to the outside world because our virtual
network has NAT enabled. This is done by routing the traffic from <code>vnet0</code> to the
virtual network's network namespace, where the iptables <code>MASQUERADE</code> rule will
then NAT the traffic out.</p>
<p>We can show this NAT traffic like this:</p>
<p><img alt="SF single node networking, one instance with no floating interfaces showing NAT path" src="../sf-single-node-networking-unfloat-instance-nat.png" /></p>
<h2 id="single-node-install-one-network-and-one-instance-with-no-floating-ip_1">Single node install, one network and one instance with no floating IP</h2>
<p>Let's add a second instance, but this time with a floating IP associated with it:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>sf-client<span class="w"> </span>instance<span class="w"> </span>create<span class="w"> </span>floatingdemo<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span>-d<span class="w"> </span><span class="m">10</span>@debian:11<span class="w"> </span>-f<span class="w"> </span>demo
uuid<span class="w">          </span>:<span class="w"> </span>08c0ae07-6a4b-4f63-9d50-a172039091a0
...

Interfaces:

<span class="w">    </span>uuid<span class="w">    </span>:<span class="w"> </span>a4cfa174-cce9-4cda-907a-b90d7f54efd1
<span class="w">    </span>network<span class="w"> </span>:<span class="w"> </span>17be6538-8f96-4ccb-b71e-a7e3022fead3
<span class="w">    </span>macaddr<span class="w"> </span>:<span class="w"> </span><span class="m">02</span>:00:00:c7:f9:cc
<span class="w">    </span>order<span class="w">   </span>:<span class="w"> </span><span class="m">0</span>
<span class="w">    </span>ipv4<span class="w">    </span>:<span class="w"> </span><span class="m">172</span>.16.0.37
<span class="w">    </span>floating:<span class="w"> </span><span class="m">192</span>.168.15.29
<span class="w">    </span>model<span class="w">   </span>:<span class="w"> </span>virtio
...
</code></pre></div>
<p>Again we add a <code>vnet</code> device via libvirt:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>ip<span class="w"> </span>a
...
<span class="m">17</span>:<span class="w"> </span>vnet1:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">8900</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>master<span class="w"> </span>br-vxlan-e2300f<span class="w"> </span>state<span class="w"> </span>UNKNOWN<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span>fe:00:00:c7:f9:cc<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff
<span class="m">19</span>:<span class="w"> </span>flt-c0a80f1d-o@if18:<span class="w"> </span>&lt;BROADCAST,MULTICAST&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">8900</span><span class="w"> </span>qdisc<span class="w"> </span>noop<span class="w"> </span>state<span class="w"> </span>DOWN<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span>aa:5c:1c:0c:7c:f6<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff<span class="w"> </span>link-netns<span class="w"> </span>17be6538-8f96-4ccb-b71e-a7e3022fead3
</code></pre></div>
<p>But we've also added another veth pair, this time named <code>flt-c0a80f1d-o</code> on the
outside of the network namespace. You can see in the instance details above that
the floating IP associated with this instance is <code>192.168.15.29</code>, which just so
happens to be <code>c0a80f1d</code> in hexadecimal. So this veth is how floating IP traffic
is delivered to an instance.</p>
<p>Here's another diagram showing the new setup:</p>
<p><img alt="SF single node networking, two instances with one having a floating IP" src="../sf-single-node-networking-two-instances-one-floating-ip.png" /></p>
<p>Its important to note that traffic <em>from</em> the instance still goes via the NAT
route shown above, while traffic <em>to</em> the instance via the floating IP uses this
veth. Replies to floating IP requests return via this veth as well though.</p>
<p>The instance isn't aware of its floating IP at an operating system level at all.
That is, inside the network namespace the veth attaches to, we do DNAT to mangle
the traffic to the instance:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>17be6538-8f96-4ccb-b71e-a7e3022fead3<span class="w"> </span>iptables<span class="w"> </span>-L<span class="w"> </span>-t<span class="w"> </span>nat
Chain<span class="w"> </span>PREROUTING<span class="w"> </span><span class="o">(</span>policy<span class="w"> </span>ACCEPT<span class="o">)</span>
target<span class="w">     </span>prot<span class="w"> </span>opt<span class="w"> </span><span class="nb">source</span><span class="w">               </span>destination
DNAT<span class="w">       </span>all<span class="w">  </span>--<span class="w">  </span>anywhere<span class="w">             </span><span class="m">192</span>.168.15.29<span class="w">        </span>to:172.16.0.37

Chain<span class="w"> </span>INPUT<span class="w"> </span><span class="o">(</span>policy<span class="w"> </span>ACCEPT<span class="o">)</span>
target<span class="w">     </span>prot<span class="w"> </span>opt<span class="w"> </span><span class="nb">source</span><span class="w">               </span>destination

Chain<span class="w"> </span>OUTPUT<span class="w"> </span><span class="o">(</span>policy<span class="w"> </span>ACCEPT<span class="o">)</span>
target<span class="w">     </span>prot<span class="w"> </span>opt<span class="w"> </span><span class="nb">source</span><span class="w">               </span>destination

Chain<span class="w"> </span>POSTROUTING<span class="w"> </span><span class="o">(</span>policy<span class="w"> </span>ACCEPT<span class="o">)</span>
target<span class="w">     </span>prot<span class="w"> </span>opt<span class="w"> </span><span class="nb">source</span><span class="w">               </span>destination
MASQUERADE<span class="w">  </span>all<span class="w">  </span>--<span class="w">  </span><span class="m">172</span>.16.0.0/24<span class="w">        </span>anywhere
</code></pre></div>
<p>So our floating IP of <code>192.168.15.29</code> is DNAT'ed to the instance's IP of
<code>172.16.0.37</code>. This means floating IP traffic "bounces" off the network namespace.
To make that work, the inside of the veth is configured with the floating IP:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>17be6538-8f96-4ccb-b71e-a7e3022fead3<span class="w"> </span>ip<span class="w"> </span>a
...
<span class="m">18</span>:<span class="w"> </span>flt-c0a80f1d-i@if19:<span class="w"> </span>&lt;BROADCAST,MULTICAST&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">1500</span><span class="w"> </span>qdisc<span class="w"> </span>noop<span class="w"> </span>state<span class="w"> </span>DOWN<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/ether<span class="w"> </span>fe:cb:4c:4a:17:ef<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff<span class="w"> </span>link-netnsid<span class="w"> </span><span class="m">0</span>
<span class="w">    </span>inet<span class="w"> </span><span class="m">192</span>.168.15.29/32<span class="w"> </span>scope<span class="w"> </span>global<span class="w"> </span>flt-c0a80f1d-i
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
</code></pre></div>
<p>Note the <code>/32</code> netmask for that address assignment. Notably, the routing table
for the outer linux still looks like this:</p>
<div class="highlight"><pre><span></span><code>debian@test:~$<span class="w"> </span>ip<span class="w"> </span>route
default<span class="w"> </span>via<span class="w"> </span><span class="m">10</span>.0.0.1<span class="w"> </span>dev<span class="w"> </span>eth0
<span class="m">10</span>.0.0.0/24<span class="w"> </span>dev<span class="w"> </span>eth0<span class="w"> </span>proto<span class="w"> </span>kernel<span class="w"> </span>scope<span class="w"> </span>link<span class="w"> </span>src<span class="w"> </span><span class="m">10</span>.0.0.74
<span class="m">192</span>.168.15.0/24<span class="w"> </span>dev<span class="w"> </span>egr-br-eth0<span class="w"> </span>proto<span class="w"> </span>kernel<span class="w"> </span>scope<span class="w"> </span>link<span class="w"> </span>src<span class="w"> </span><span class="m">192</span>.168.15.1
</code></pre></div>
<p>The outer linux knows to route the floating IP down that veth because of this
address assigned on the inside of the namespace.</p>
<p>Let's have a final diagram showing how a packet for a floating IP gets to its
instance:</p>
<p><img alt="SF single node networking, two instances with one having a floating IP showing ingress path" src="../sf-single-node-networking-two-instances-one-floating-ip-ingress.png" /></p>
<h2 id="multiple-nodes">Multiple nodes</h2>
<p>Its actually a relatively small step from the above to multiple hypervisor nodes,
as additional nodes don't have the network namespace or the veths -- those exist
only on the network node (node 1 in our example).</p>
<p><img alt="SF multinode networking" src="../sf-multinode-networking.png" /></p>
<h2 id="routed-ips">Routed IPs</h2>
<p>Shaken Fist v0.8 introduced the concept of <em>routed IPs</em> to support Kubernetes
services in the K3S orchestration support. A routed IP is an address from the
floating address pool which uses routing to deliver traffic to the relevant
virtual network. An interface on the virtual network must then have been
configured by the user to answer ARP requests for that address. This works well
with metallb, which our K3S orchestration uses to expose services, but would
work equally well for other traffic.</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>The fundamental difference between a floating IP and a routed IP is whether
the destination of the traffic inside the virtual network is aware of the
address. A floating IP is packet mangled on its way to an interface so that
the interface can't tell that the traffic was sent to a floating IP. On the
other hand, an interface with a routed address can tell that the traffic was
intended for a specific floating IP, but in return must have been configured
to use that floating IP.</p>
</details>
<p>The implementation of routed IPs is relatively trivial. For each routed IP, a
route on the network node into the relevant virtual network bridge is created.
Such a route might look like this:</p>
<div class="highlight"><pre><span></span><code>ip route add 192.168.15.29/32 dev br-vxlan-e2300f
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  </body>
</html>