# As recommended on the ansible apt module documentation...
- name: Install modern ansible
  apt:
    name: ansible
    state: latest
    update_cache: yes
    autoremove: yes
  register: apt_action
  retries: 100
  until: apt_action is success or ('Failed to lock apt for exclusive operation' not in apt_action.msg and '/var/lib/dpkg/lock' not in apt_action.msg)

- name: Copy client wheel file
  copy:
    src: "{{source_path}}/client-python/dist/{{hostvars['localhost']['client_wheel_file']}}"
    dest: "/tmp/{{hostvars['localhost']['client_wheel_file']}}"

- name: Copy server wheel file
  copy:
    src: "{{source_path}}/shakenfist/dist/{{hostvars['localhost']['server_wheel_file']}}"
    dest: "/tmp/{{hostvars['localhost']['server_wheel_file']}}"

- name: Copy ssh key to primary node
  copy:
    src: /home/jenkins/id_ci
    dest: /root/.ssh/id_rsa
    owner: root
    group: root
    mode: u=r,g=,o=
